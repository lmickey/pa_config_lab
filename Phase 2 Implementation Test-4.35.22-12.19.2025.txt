============================================================
Phase 2 Implementation Tests
============================================================

============================================================
Prisma Access Credentials
============================================================
Enter credentials to test against a real tenant.
Press Enter to skip and run structure tests only.

Test against real tenant? (y/n): y
Enter TSG ID: 1570970024
Enter API Client ID: cursor-dev@1570970024.iam.panserviceaccount.com
Enter API Client Secret: 

Credentials provided. Testing against real tenant...

Initializing API client...
✓ API client initialized successfully

============================================================
Test 1: Folder Capture
============================================================
✓ Folder capture module structure correct

  Testing against real tenant...
  Note: Security policy folders endpoint returned 403, trying alternative discovery...
  ✓ Discovered 6 folders
    - Service Connections (default: False)
    - Remote Networks (default: False)
    - Mobile User Container (default: False)
    - Access Agent (default: False)
    - GlobalProtect (default: False)
    - Explicit Proxy (default: False)
  Note: Security policy folders endpoint returned 403, trying alternative discovery...
  ✓ Built folder hierarchy (6 folders)
  Note: Security policy folders endpoint returned 403, trying alternative discovery...
  ✓ Listed 6 non-default folders for capture

============================================================
Test 2: Rule Capture
============================================================
✓ Rule capture module structure correct

  Testing against real tenant...
  Note: Security policy folders endpoint returned 403, trying alternative discovery...
  Testing with folder: Service Connections
Error capturing rules from folder Service Connections: 403 Client Error: Forbidden for url: https://api.sase.paloaltonetworks.com/sse/config/v1/security-policy/security-rules?folder=Service+Connections
  ✓ Captured 0 rules from Service Connections
  ⚠ WARNING: No rules found in folder Service Connections

============================================================
Test 3: Object Capture
============================================================
✓ Object capture module structure correct

  Testing against real tenant...
  Note: Security policy folders endpoint returned 403, trying alternative discovery...
  Testing with folder: Service Connections
  ✓ Captured 3 address objects
  ✓ Captured 1 address groups
Capturing objects from folder: Service Connections
  Captured 208 objects
    address_objects: 3
    address_groups: 1
    service_objects: 4
    applications: 200
  ✓ Captured 208 total objects

============================================================
Test 4: Profile Capture
============================================================
✓ Profile capture module structure correct

  Testing against real tenant...
  Note: Security policy folders endpoint returned 403, trying alternative discovery...
  Testing with folder: Service Connections
  ✓ Captured 2 authentication profiles
Capturing profiles from folder: Service Connections
Capturing antivirus profiles...
Capturing anti_spyware profiles...
Capturing vulnerability profiles...
Capturing url_filtering profiles...
Capturing file_blocking profiles...
Capturing wildfire profiles...
Capturing data_filtering profiles...
  Captured 2 profiles
    Authentication: 2
    Security: 0
    Decryption: 0
  ✓ Captured 2 auth profiles, 0 security profiles

============================================================
Test 5: Snippet Capture
============================================================
✓ Snippet capture module structure correct

  Testing against real tenant...
Error discovering snippets: 403 Client Error: Forbidden for url: https://api.sase.paloaltonetworks.com/sse/config/v1/security-policy/snippets
  ✓ Discovered 0 snippets

============================================================
Test 6: Pull Orchestrator
============================================================
✓ Pull orchestrator module structure correct

  Testing against real tenant...
  Note: Security policy folders endpoint returned 403, trying alternative discovery...
  Testing pull with folder: Service Connections
    [1/3] Capturing rules from Service Connections
Error capturing rules from folder Service Connections: 403 Client Error: Forbidden for url: https://api.sase.paloaltonetworks.com/sse/config/v1/security-policy/security-rules?folder=Service+Connections
    [2/3] Capturing objects from Service Connections
Capturing objects from folder: Service Connections
  Captured 208 objects
    address_objects: 3
    address_groups: 1
    service_objects: 4
    applications: 200
    [3/3] Capturing profiles from Service Connections
Capturing profiles from folder: Service Connections
Capturing antivirus profiles...
Capturing anti_spyware profiles...
Capturing vulnerability profiles...
Capturing url_filtering profiles...
Capturing file_blocking profiles...
Capturing wildfire profiles...
Capturing data_filtering profiles...
  Captured 2 profiles
    Authentication: 2
    Security: 0
    Decryption: 0
  ✓ Pulled configuration for Service Connections
    Rules: 0
  ✓ Pull report generated
    Stats: {'folders_captured': 1, 'rules_captured': 0, 'objects_captured': 208, 'profiles_captured': 2, 'snippets_captured': 0, 'errors': []}

============================================================
Test 7: Config Pull
============================================================
✓ Config pull module structure correct

  Testing against real tenant...
  Testing pull_folders_only...
  Note: Security policy folders endpoint returned 403, trying alternative discovery...
  Pulling 1 folder(s)...
[1/1] Pulling folder Service Connections
[1/3] Capturing rules from Service Connections
Error capturing rules from folder Service Connections: 403 Client Error: Forbidden for url: https://api.sase.paloaltonetworks.com/sse/config/v1/security-policy/security-rules?folder=Service+Connections
  ✓ Pulled 1 folder configuration(s)
    Folder: Service Connections
    Rules: 0

============================================================
Test 8: Module Integration
============================================================
✓ All modules integrate correctly

  Testing orchestrator integration...
  ✓ All capture modules initialized in orchestrator

============================================================
Test Summary
============================================================
Passed: 8/8

Note: Tests were run against a real tenant

