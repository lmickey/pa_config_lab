# Terraform Outputs
# Generated by pa_config_lab TerraformGenerator

# =============================================================================
# Resource Group
# =============================================================================

output "resource_group_name" {
  description = "Name of the resource group"
  value       = azurerm_resource_group.main.name
}

output "resource_group_location" {
  description = "Location of the resource group"
  value       = azurerm_resource_group.main.location
}

# =============================================================================
# Network
# =============================================================================

output "vnet_name" {
  description = "Name of the virtual network"
  value       = azurerm_virtual_network.main.name
}

output "vnet_id" {
  description = "ID of the virtual network"
  value       = azurerm_virtual_network.main.id
}

# =============================================================================
# Firewall Outputs
# =============================================================================

{% for fw in firewalls %}
output "{{ fw.name | replace('-', '_') }}_management_ip" {
  description = "Management public IP for {{ fw.name }}"
  value       = azurerm_public_ip.{{ fw.name | replace('-', '_') }}_mgmt.ip_address
}

output "{{ fw.name | replace('-', '_') }}_untrust_ip" {
  description = "Untrust public IP for {{ fw.name }}"
  value       = azurerm_public_ip.{{ fw.name | replace('-', '_') }}_untrust.ip_address
}

output "{{ fw.name | replace('-', '_') }}_trust_private_ip" {
  description = "Trust private IP for {{ fw.name }}"
  value       = azurerm_network_interface.{{ fw.name | replace('-', '_') }}_trust.private_ip_address
}

{% endfor %}

# Aggregated firewall outputs
output "firewall_management_ips" {
  description = "Map of firewall names to management IPs"
  value = {
{% for fw in firewalls %}
    "{{ fw.name }}" = azurerm_public_ip.{{ fw.name | replace('-', '_') }}_mgmt.ip_address
{% endfor %}
  }
}

output "firewall_untrust_ips" {
  description = "Map of firewall names to untrust IPs"
  value = {
{% for fw in firewalls %}
    "{{ fw.name }}" = azurerm_public_ip.{{ fw.name | replace('-', '_') }}_untrust.ip_address
{% endfor %}
  }
}

# =============================================================================
# Panorama Outputs
# =============================================================================

{% if panorama %}
output "panorama_management_ip" {
  description = "Management public IP for Panorama"
  value       = azurerm_public_ip.panorama_mgmt.ip_address
}

output "panorama_management_fqdn" {
  description = "Management FQDN for Panorama"
  value       = azurerm_public_ip.panorama_mgmt.fqdn
}
{% endif %}

# =============================================================================
# Supporting VM Outputs
# =============================================================================

{% for server in servers %}
output "{{ server.name | replace('-', '_') }}_private_ip" {
  description = "Private IP for {{ server.name }}"
  value       = azurerm_network_interface.{{ server.name | replace('-', '_') }}.private_ip_address
}

{% endfor %}

{% for client in clients %}
output "{{ client.name | replace('-', '_') }}_private_ip" {
  description = "Private IP for {{ client.name }}"
  value       = azurerm_network_interface.{{ client.name | replace('-', '_') }}.private_ip_address
}

{% endfor %}

{% for ztna in ztna_connectors %}
output "{{ ztna.name | replace('-', '_') }}_private_ip" {
  description = "Private IP for {{ ztna.name }}"
  value       = azurerm_network_interface.{{ ztna.name | replace('-', '_') }}.private_ip_address
}

{% endfor %}

# =============================================================================
# Summary Output
# =============================================================================

output "deployment_summary" {
  description = "Summary of deployed resources"
  value = {
    resource_group = azurerm_resource_group.main.name
    location       = azurerm_resource_group.main.location
    vnet           = azurerm_virtual_network.main.name
    firewalls      = [{% for fw in firewalls %}"{{ fw.name }}"{% if not loop.last %}, {% endif %}{% endfor %}]
{% if panorama %}
    panorama       = "{{ panorama.name }}"
{% endif %}
    servers        = [{% for s in servers %}"{{ s.name }}"{% if not loop.last %}, {% endif %}{% endfor %}]
    clients        = [{% for c in clients %}"{{ c.name }}"{% if not loop.last %}, {% endif %}{% endfor %}]
    ztna_connectors = [{% for z in ztna_connectors %}"{{ z.name }}"{% if not loop.last %}, {% endif %}{% endfor %}]
  }
}
